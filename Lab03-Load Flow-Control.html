<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏™‡πà‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î (Overload Relief)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #F8FAFC; }
        .chart-container { position: relative; height: 250px; width: 100%; }
        /* Cables */
        .cable { transition: all 0.5s; stroke-dasharray: 10; animation: flow 1s linear infinite; }
        @keyframes flow { to { stroke-dashoffset: -20; } }
        .cable.overload { stroke: #EF4444; stroke-width: 6; filter: drop-shadow(0 0 5px red); animation: flow 0.2s linear infinite; }
        .cable.normal { stroke: #3B82F6; stroke-width: 4; }
        /* Icons */
        .plant-icon { font-size: 2rem; }
    </style>
</head>
<body class="p-6">

    <!-- Header -->
    <header class="max-w-5xl mx-auto mb-8 flex justify-between items-center bg-white p-6 rounded-xl shadow-sm">
        <div>
            <h1 class="text-2xl font-bold text-slate-800">‚ö°Ô∏è Power Flow Control Lab</h1>
            <p class="text-slate-500">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏™‡πà‡∏á Overload</p>
        </div>
        <div class="text-right text-sm">
            <div class="text-slate-500">Total Load Demand</div>
            <div class="text-2xl font-bold text-slate-800">200 MW</div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto grid lg:grid-cols-3 gap-8">
        
        <!-- CONTROL PANEL -->
        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <h2 class="font-bold text-lg mb-6 flex items-center gap-2">
                <span>üéõÔ∏è</span> Dispatch Control
            </h2>

            <!-- Remote Gen Control -->
            <div class="mb-8">
                <div class="flex justify-between mb-2">
                    <label class="font-bold text-slate-700">1. ‡πÇ‡∏£‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô (‡πÑ‡∏Å‡∏•)</label>
                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≥</span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-2xl">üè≠</span>
                    <div class="w-full">
                        <input type="range" id="remote-gen" min="0" max="200" value="150" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-600" oninput="updateSystem()">
                        <div class="flex justify-between text-xs text-slate-500 mt-1">
                            <span>0 MW</span>
                            <span id="remote-val" class="font-bold text-slate-800 text-sm">150 MW</span>
                            <span>200 MW</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Local Gen Control -->
            <div class="mb-8 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                <div class="flex justify-between mb-2">
                    <label class="font-bold text-yellow-800">2. ‡πÇ‡∏£‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Å‡πä‡∏≤‡∏ã‡∏Ø (‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á)</label>
                    <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏π‡∏á</span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-2xl">‚ö°Ô∏è</span>
                    <div class="w-full">
                        <!-- Auto-calculated, read-only visualization -->
                        <div class="w-full h-2 bg-yellow-200 rounded-lg overflow-hidden">
                            <div id="local-bar" class="h-full bg-yellow-500 transition-all duration-300" style="width: 25%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-slate-500 mt-1">
                            <span>Auto Balance</span>
                            <span id="local-val" class="font-bold text-yellow-700 text-sm">50 MW</span>
                        </div>
                    </div>
                </div>
                <p class="text-xs text-yellow-700 mt-2">* ‡πÇ‡∏£‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏à‡∏≤‡∏Å‡πÇ‡∏£‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÇ‡∏´‡∏•‡∏î (Slack Role)</p>
            </div>

            <!-- Cost Indicator -->
            <div class="border-t pt-4">
                <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-500">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏ß‡∏°:</span>
                    <span id="total-cost" class="text-xl font-bold text-slate-800">$1,750 / hr</span>
                </div>
            </div>
        </div>

        <!-- VISUALIZATION -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Circuit Diagram -->
            <div class="bg-slate-900 rounded-xl p-8 relative h-[300px] flex items-center justify-between overflow-hidden">
                <!-- SVG Lines -->
                <svg class="absolute inset-0 w-full h-full pointer-events-none">
                    <!-- Line A (Top) -->
                    <path id="line-a" d="M 100 150 Q 300 50 500 150" fill="none" class="cable normal" />
                    <!-- Line B (Bottom) -->
                    <path id="line-b" d="M 100 150 Q 300 250 500 150" fill="none" class="cable normal" />
                </svg>

                <!-- Bus 1 (Remote) -->
                <div class="relative z-10 text-center">
                    <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center text-3xl shadow-lg border-4 border-slate-700">üè≠</div>
                    <div class="mt-2 text-white font-bold">Bus 1</div>
                    <div class="text-slate-400 text-sm">Remote</div>
                </div>

                <!-- Labels on Lines -->
                <div class="absolute top-[30%] left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded border border-slate-600 z-10">
                    Line A (High Z)
                    <div id="flow-a" class="font-bold text-blue-400">-- MW</div>
                    <div class="text-[10px] text-red-400">Limit: 80 MW</div>
                </div>

                <div class="absolute bottom-[30%] left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded border border-slate-600 z-10">
                    Line B (Low Z)
                    <div id="flow-b" class="font-bold text-blue-400">-- MW</div>
                    <div class="text-[10px] text-green-400">Limit: 150 MW</div>
                </div>

                <!-- Bus 2 (Local) -->
                <div class="relative z-10 text-center">
                    <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center text-3xl shadow-lg border-4 border-slate-700">üèôÔ∏è</div>
                    <div class="mt-2 text-white font-bold">Bus 2</div>
                    <div class="text-slate-400 text-sm">Load + Local Gen</div>
                </div>
            </div>

            <!-- Monitoring Chart -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-4">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏£‡∏∞‡∏™‡∏≤‡∏¢‡∏™‡πà‡∏á (Line Loading %)</h3>
                <div class="chart-container">
                    <canvas id="loadChart"></canvas>
                </div>
            </div>

        </div>
    </main>

    <script>
        // System Parameters
        const TOTAL_LOAD = 200; // MW
        const LINE_A_LIMIT = 80; // MW
        const LINE_B_LIMIT = 150; // MW
        
        // Impedance Ratio (Inverse of Admittance)
        // Line B is "stiffer" (less impedance), taking more flow naturally.
        // Let's say Line A takes 40% of flow, Line B takes 60% of flow from Remote Gen.
        const FLOW_RATIO_A = 0.4; 
        const FLOW_RATIO_B = 0.6;

        // Costs
        const COST_REMOTE = 10; // $/MW
        const COST_LOCAL = 25;  // $/MW

        let chart;

        function init() {
            const ctx = document.getElementById('loadChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Line A (Limit 80MW)', 'Line B (Limit 150MW)'],
                    datasets: [{
                        label: 'Current Flow (MW)',
                        data: [0, 0],
                        backgroundColor: ['#3B82F6', '#3B82F6'],
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: { x: { max: 160 } },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            updateSystem();
        }

        function updateSystem() {
            // 1. Get Inputs
            const remoteGenP = parseInt(document.getElementById('remote-gen').value);
            
            // 2. Dispatch Logic (Balance Load)
            // Local Gen must supply the rest
            let localGenP = TOTAL_LOAD - remoteGenP;
            if (localGenP < 0) localGenP = 0; // Can't happen with slider max 200 but safe to add

            // 3. Calculate Flows
            // Power from Remote Gen splits into Line A and B
            const flowA = remoteGenP * FLOW_RATIO_A;
            const flowB = remoteGenP * FLOW_RATIO_B;

            // 4. Calculate Cost
            const totalCost = (remoteGenP * COST_REMOTE) + (localGenP * COST_LOCAL);

            // 5. Update UI Text
            document.getElementById('remote-val').innerText = remoteGenP + " MW";
            document.getElementById('local-val').innerText = localGenP + " MW";
            document.getElementById('local-bar').style.width = (localGenP / 200 * 100) + "%";
            document.getElementById('flow-a').innerText = flowA.toFixed(1) + " MW";
            document.getElementById('flow-b').innerText = flowB.toFixed(1) + " MW";
            document.getElementById('total-cost').innerText = "$" + totalCost.toLocaleString();

            // 6. Visual Logic (Overload Check)
            const lineA = document.getElementById('line-a');
            const lineB = document.getElementById('line-b');

            // Line A Check
            if (flowA > LINE_A_LIMIT) {
                lineA.classList.remove('normal');
                lineA.classList.add('overload');
                chart.data.datasets[0].backgroundColor[0] = '#EF4444'; // Red
            } else {
                lineA.classList.remove('overload');
                lineA.classList.add('normal');
                chart.data.datasets[0].backgroundColor[0] = '#3B82F6'; // Blue
            }

            // Line B Check
            if (flowB > LINE_B_LIMIT) {
                lineB.classList.remove('normal');
                lineB.classList.add('overload');
                chart.data.datasets[0].backgroundColor[1] = '#EF4444';
            } else {
                lineB.classList.remove('overload');
                lineB.classList.add('normal');
                chart.data.datasets[0].backgroundColor[1] = '#3B82F6';
            }

            // 7. Update Chart Data
            chart.data.datasets[0].data = [flowA, flowB];
            chart.update();
        }

        window.onload = init;
    </script>
</body>
</html>